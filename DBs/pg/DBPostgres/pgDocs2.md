
## Schemas

Кластер содержит одну или более баз.
Юзеры и группы шарятся по кластеру, но больше ничего не шарится между базами.
Один коннекшн доступается до одной базы.
Права пользователей внутри кластера могут различаться для разных баз.
Не может быть разных юзеров с одним именем в одном кластере.

*База содержит* одну или более схем. *Схема содержит* таблицы. 
Схема также содержит типы данных, функции, операторы.
Одно имя объекта может использоваться в разных схемах без конфликтов.
Коннекшн идет к базе. Пользователь может доступаться до любой схемы в этой базе, если имеет привилегии.

Схемы используют когда:

* Много юзеров используют одну базу без влияния на данные друг друга.
* Группирование объектов БД.
* Как неймспейс для third-party приложений.

Схемы похожи на директории. Но не могут быть вложенными.

CREATE SCHEMA myschema;
CREATE TABLE myschema.mytable...

Удаление пустой схемы:
DROP SCHEMA myschema;

Удаление непустой схемы:
DROP SCHEMA myschema CASCADE;

database.schema.table (pg поддерживает это для проформы, если вы и можете указать имя базы - то тоже самое, к которой уже подключены).

CREATE SCHEMA schemaname AUTHORIZATION username;

schemaname - by default - username:
CREATE SCHEMA AUTHORIZATION username;

Имена схем, начинающиеся с pg_ - зарезервированы.

### Схема public.

Все свежесозданные БД содержат схему public.

### Поиск схемы

Может быть такое, что таблица есть в какой-то схеме, но без указания схемы pg её не найдет.

1. Схема, с именем как у текущего юзера.
2. public

Изменение путей поиска:
SET search_path TO myschema,public;

public схему можно удалить. В ней нет чего-то специального (просто создается по-умолчанию).

Этот же путь работает для поиска других объектов базы без указания схемы.

Явное указание схемы для оператора:

```
OPERATOR(schema.operator)
SELECT 3 OPERATOR(pg_catalog.+) 4
```
### Схемы и привилегии.

По-умолчанию до объектов схемы может доступиться только её хозяин.

USAGE - дает другим пользователям право пользоваться.
CREATE - дает права создавать объекты.
По-дефолту все имеют эти права на схему public, их можно отменить CREATE так:

REVOKE CREATE ON SCHEMA public FROM PUBLIC;

PUBLIC - means every user.

Похоже, pg иногда умеет отличать identifier от keyword.

### System catalog schema

Каждая БД содержит схему pg_catalog, она содержит системные таблицы и все встроенные типы, функции, операторы.
И поиск в этой схеме идет перед search_path.
Если явно положить *pg_catalog в search_path*, то можно подменять встроенные объекты своими.
Не юзай pg_ префикс, иначе могут быт клэши в будущем (или даже в настоящем :) ).

### Usage patterns

* Использование схемы по дефолту. Удобно, когда мало юзеров, и когда хочется совместимости с БД без схем.

* Создание одноименной схемы для каждого юзера. Надо задуматься над доступами к public схеме.

* Изолировать что-то (общие приложения, third party объекты) в отдельной схеме и дать всем привилегии. Юзеры могут либо явно указывать схему, либо настроить свои search_path.

### Портабельность

В стандарте SQL нет упоминаний о разных хозяевах для одной схемы. И многие имплементации не позволяют даже создавать схемы с именами отличными от имен пользователей. Вообще понятие схемы и пользователя сходны для баз, имплементирующих базовые свойства схем.
Т.е. для многих юзеров привычно использовать username.tablename. И для pg это тоже привычно.

В SQL стандарте нет обязательной схемы public. Для макс. совместимости не нужно её юзать.
Некоторые бд не применяют схемы, некоторые юзают неймспейсы, если нужно поддерживать совместимость с этими системами - лучше вообще не использовать схемы.







































