https://uni.dtln.ru/digest/analiz-proizvoditelnosti-vm-v-vmware-vsphere-chast-1-cpu

ESXTOP - from ESXi command line.

*world* process.

# Four states

* Run - выполняет полезную работу.
* Wait - не выполняет работу, возможно ждет ввода/вывода.
* Co-Stop - Возникает в многоядерных ВМ, когда планировщик (ESXi CPU Scheduler)
не может запланировать одновременное исполнение
на физических ядрах всех активных виртуальных ядер.
Гостевая ОС рассчитывает, что все ядра работают параллельно,
поэтому гипервизору приходится замедлять ядра ВМ, у которых
есть возможность закончить такт быстрее.
* Ready - у гипервизора нет ресурсов, которые можно выделить для исполнения процесса.

## relaxed co-scheduling

Гипервизор считает разрыв между самым быстрым и самым медленным ядром виртуальной
машины (skew). Если разрыв превышает определенный порог, быстрое ядро переходит в состояние co-stop.
Если в этом времени ядра проводят много времени - могут быть проблемы
с производительностью.

====

При большой загрузке VM может пропадать из сети.

Если ядра грузятся сильно неравномерно - есть смысл перенести машину на более
производительный сервер.

=====

# vCenter имеет пару счетчиков для CPU Ready

* Readiness (проценты в real-time). Для поиска проблем по горячим следам.
* Ready (сколько ms за период измерения ядро было в Ready) - можно глянуть в исторической перспективе.

Если большие значения: нужно увеличивать отношение физических ядер к виртуальным.

# CO-STOP

(CPU co-stop summation value / (<chart default update interval in seconds> * 1000)) * 100 = CPU co-stop %

В идеале должен быть нулем.

Не надо добавлять ядра про запас.

# Другие полезные метрики

* Run
* Idle (высокие значения - не проблема)
* Wait. Если Wait высокий, а Idle низкий - значит долго ждем I/O, и возможно
тормозит диск, или другие I/O устройства.
* Max Limited
* 











