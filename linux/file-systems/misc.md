https://losst.pro/chto-takoe-inode

inode - место хранение метаданных.
В т.ч. блоки на диске где размещается файл.

https://losst.pro/kakuyu-fajlovuyu-sistemu-vybrat-dlya-linux

# BtrFS, ZFS - Будущее ?
* Дедупликация данных.
* Управление томами?
* Одна FS на нескольких дисках.
* Контрольные суммы.
* Снапшоты.

## Ext4 (2006)
https://losst.pro/fajlovaya-sistema-ext4


Если выключить питание в момент записи файлов - может накрыться файловая система.
Журналируемые ФС устойчивы к сбоям в питании.
C Ext3.

Есть режимы журналирования.

* Самый безопасный, когда журналируются и данные и метаданные.
Но производительность страдает.

* Упорядоченный. Используется по умолчанию.
Метаданные в журнал. Данные в ФС. Метаданные в ФС.
Тогда при сбое повреждаются только записываемые файлы а не вся ФС.

* Обратная запись. В журнал тоже только метаданные. Но параллельно с данными они пишутся и на диск.

Метаданные:
* Размер
* Время создания
* Время последнего изменения.
* Битовые признаки (например ридонли)
* Права доступа.

Диск м.б. более 16 ТБ.

Оптимизация по производительности.

Неограниченная вложенность подкаталогов.
В Ext3 было 32к.

## Плюсы Ext4

* Журналирование
* Поддержка шифрования
* Стабильность (очень хорошо потестена)
* Широкая поддержка в дистрибутивах
* Не фрагментируется
* Большие лимиты, даже для серверов.

## Минусы Ext4

* Не поддерживается управление томами и дедубликация данных.
* Не поддерживает контрольные суммы. Не отслеживает повреждения из-за аппаратных сбоев.
* Плохо масштабируется. Лучше не создавать разделы более 50 террабайт.

===================================

# XFS (Extended File System)
2001-linux.

Похожа на Ext4, но нельзя уменьшать разделы.
Хорошо работает с большими файлами, плохо с мелкими.

===================================

# JFS

В журнале сохраняются только метаданные.
Тоже можно только увеличить раздел.
Хорошо работает и с большими и с мелкими файлами.
Слабо потестена, т.к. мало кто юзает.

===================================

# BtrFS (B-Tree File System) (2006 Oracle)

Будущее.
По умолчанию идет в SUSE.
Считается стабильной.

===================================

# ReiserFS (2001)

* Есть управление томами.
* Можно добавить кэширующий диск.
* Может паковать несколько файлов в один блок. Быстрая. Ест мало памяти.
* Но поддержка заброшена.

===================================

# ZFS (2005) (Zettabyte File System)

* Тома
* КС
* Сжатие
* Шифрование
* Огромные лимиты

===================================

# F2FS (специально для SSD)

===================================

# BtrFS vs Ext4

https://linuxcool.net/obzory/sravnenie-fajlovyh-sistem-linux-btrfs-i-ext4/

## Btrfs
Активно юзает метаданные.
При копировании записывается только измененная часть.
Хорошо стапшотится.

Том - это смонтированный раздел диска.

btrfsctl

Оптимизирована для SSD

Дефрагментация.
Дедупликация.

RAID на уровне FS.

Дефрагментация на лету.

https://habr.com/ru/companies/veeam/articles/458250/

Говорят, что бывают проблемы.

## Ext4 - дефрагментация в реальном времени.


===================================





===================================







===================================



===================================







We are going to play with file descriptors, pipes, different tools such as
nohup
pv,
tmux
strace
bpftrace

https://biriukov.dev/docs/fd-pipe-session-terminal/1-file-descriptor-and-open-file-description/

File descriptor - positive integer number.
Every process has file descriptors table.
Decouples file path (more correctly - inode),
and object inside process.

There also system-wide open file description table.

Thread -> task_struct->files_struct->array of pointers to file struct.
file struct contains position, flags, and some another info.


========

Ext Extended file system

Ext4.

========

https://www.youtube.com/watch?v=VHsdTssvqNI

Можно подмонтировать раздел диска к директории.

https://ru.wikipedia.org/wiki/FHS

FileSystem Hierarchy Standard

/bin - основные утилиты
/boot - загрузочные файлы
/dev - устройства
/etc - конфиги
/home - юзерские данные
/lib - либы для /bin, /sbin
/media - сменные носители
/mnt - временно монтируемые FS
/opt - доп ПО
/proc - состояние ядра ОС и запущенных процессов.
/root - дом рута
/run - Инфа о системе, в том числе данные нужные демонам (pid, сокеты и т.д.)
/sbin - системные бинарники
/srv - данные для всяких www, ftp
/sys - данные о устройствах, драйверах, и некоторых свойствах ядра.
/tmp
/usr - Вторичная иерархия для данных пользователя. Юзерские тулзы для работы в многопользовательском режиме.
/var - Изменяемые файлы (кэши, данные дляБД, блокировки, мейлы, очереди печати)

==============

lsblk

LVM - Logical Volume Manager

df - Disk Free

fallocate - создать файл.

сfdisk

Ext4 - журналируемая файловая система.
Есть журнал. Сначала изменения идут в него. Потом расходятся по файлам и метаданнным, затем удаляются из журнала.
Журнал - набор связанных изменений фс.

Если сбой и рестарт, журнал остается, и при загрузке - раскидывается по файлам.

Ext4 - и файлы и метаданные.

mkfs.ext4

mount source target

pvs
lvs

https://www.youtube.com/watch?v=3PUAEqquVEU

inode - метаданные о расположении файла.

ls -i

stat

Linux раскидывает куски файла по диску равномерно.
И есть службы по дефрагментации.

2% на служебные нужды.
5% - на службы. Чтобы .

tune2fs

e4defrag













