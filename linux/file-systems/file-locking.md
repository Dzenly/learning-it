https://www.baeldung.com/linux/file-locking

Lost update.

Рекомендательные и обязательные блокировки.

# Консультативная (advisory).

Процессы явно устанавливают блокировки.
Если процесс не знает о блокировках - он их игнорит.
Процессы *взаимодействуют* если используют общий
механизм блокировок.

**flock**

# Обязательная (mandatory)

(её реализация в Linux ненадежна)
Управляется самой OS.

* `mount -o mand FS mount_point`
* `chmod g+s,gx FILE`

# Проверка наличия блокировок

**lslocks**

Какие процессы держат блокировки, и типы блокировок.

## /proc/locks

файл в виртуальной ФС - procfs. Содержит все текущие блокировки.

* Порядковый номер
* Класс блокировки (FLOCK(flock), POSIX (lockf, fcntl))
* Тип блокировки: консультативный, обязательный
* Write or Read
* PID, который заблочил файл
* Файл: major_device:minor-device:inode.
* Начало заблоченной области.
* Конец заблоченной области.

`flock FILE command`



